#!/usr/bin/env bash

PATH="${PATH}:/usr/sbin"

for blkdev in $( nvme list | awk '/^\/dev/ { print $1 }' ) ; do
  mapping=$(nvme id-ctrl --raw-binary "${blkdev}" | cut -c3073-3104 | tr -s ' ' | sed 's/ $//g')
  if [[ "${mapping}" == /dev/* ]]; then
    if [[ ! ( -b ${blkdev} && -L ${mapping} ) ]]; then
      ln -s "${blkdev}" "${mapping}"
    fi
  fi
done
